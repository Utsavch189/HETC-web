<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exam</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Alegreya:ital@1&family=Libre+Baskerville&family=Montserrat:ital,wght@1,300&family=Open+Sans:ital,wght@1,300&family=PT+Sans+Narrow&family=Playfair+Display:ital@0;1&family=Roboto+Condensed&family=Source+Serif+Pro:ital,wght@1,300&family=Zen+Antique+Soft&display=swap');

        * {
            margin: 0;
            padding: 0;
            font-family: 'Alegreya', serif;
            font-family: 'Libre Baskerville', serif;
            font-family: 'Montserrat', sans-serif;
            font-family: 'Open Sans', sans-serif;
            font-family: 'Playfair Display', serif;
            font-family: 'PT Sans Narrow', sans-serif;
            font-family: 'Roboto Condensed', sans-serif;
            font-family: 'Source Serif Pro', serif;
            font-family: 'Zen Antique Soft', serif;
        }
        
        .head {
            background-color: rgb(42, 42, 206);
            height: 25vh;
            display: flex;
            justify-content: space-evenly;
            overflow: hidden;
        }
        
        .timer {
            display: flex;
            flex-direction: column;
            justify-content: center;
            color: white;
            width: 40vw;
        }
        
        .buttonss {
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 25vh;
            width: 30vw;
            justify-content: center;
        }
        
        .bttn {
            margin-left: 5px;
            margin-top: 5px;
            height: 25px;
            width: 25px;
            align-items: center;
        }
        
        @media only screen and (min-width: 881px) {
            .buttonss {
                justify-content: center;
            }
        }
        
        @media only screen and (max-width: 880px) {
            .head {
                height: 34vh;
            }
            .bttn {
                margin-left: 2px;
                margin-top: 1px;
                height: 23px;
                width: 23px;
            }
            .timer {
                width: 35vw;
                overflow: hidden;
            }
            .buttonss {
                height: 33vh;
                width: 55vw;
                justify-content: center;
                overflow-y: scroll;
                margin-top: 10px;
            }
            .username {
                font-size: 12px;
            }
        }
        
      
        
        .footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 8vh;
            position: absolute;
            bottom: 0;
        }
        
        .submit {
            position: absolute;
            right: 0;
            margin-right: 10px;
            margin-bottom: 5px;
        }
        .ques{
            font-weight: bold
        }
        span{
            font-weight: bold
        }
    </style>

</head>

<body>
{% if dictt.is_exam %}
    <div class="container-fluid head">
        <div class="container timer" id="tota">
            <h6 class="username text-center">{{request.user.first_name}} {{request.user.last_name}}</h6>
                        <h6 class="time text-center" id="total"></h6>

            <h6 class="time text-center">Time Left</h6>
            <h6 id="timer" class="time text-center"></h6>
        </div>

        <div class="container buttonss">
            <div class="container buttons" id="buttons"></div>

        </div>
    </div>


    <div class="container-fluid body my-2">
      
            
            <button class="btn btn-success submit"  onclick="submit()">Submit</button>
            <form  id="mainform" name="mainform" >



            <div class="container questions my-4" id="main">

                <span id="index"  class="ques"></span>
                    <span class="ques" id="ques"></span>
<br>
                    <input type="radio" name="aa" id="a" value="a"><span id="input1">  </span><br>
                <input type="radio" name="aa" id="b" value="b" ><span id="input2">  </span><br>
                <input type="radio" name="aa" id="c" value="c" ><span id="input3">  </span><br>
                <input type="radio" name="aa" id="d" value="d" > <span id="input4">  </span>

            </div>






        </form>
    </div>


    <div class="container-fluid footer">
        <button class="btn btn-primary" onclick="prev()"><-Prev</button>
        <button class="btn btn-danger" onclick="mark()">Mark</button>
        <button class="btn btn-primary" onclick="next()">Next-></button>



    </div>








    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>


    <script>
        let i = {{dictt.number_of_questions}}
        let j = 1;
        let v = 0;
let t=0;

let ques=''



document.mainform.onclick= function (){
let as=document.mainform.aa.value;
fetch(`http://127.0.0.1:8000/credentials/exam/{{request.user}}/`, {
    method: 'POST', 
    headers: {
        'Accept': 'application/json',
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({'index':`${v}`,'option':`${as}`}),
  })
if(as==='a' || as==='b' || as==='c' || as==='d'){
    let x = document.getElementById(`${v}`)
         x.style.backgroundColor='blue'
         x.style.color='white'
        
}
}


//window.onload=function(){//
    //fetch('http://127.0.0.1:8000/api/')
  //.then(response => response.json())
  //.then(data => {
     //let o= JSON.parse(data)
     
     //document.getElementById('ques').innerText=o.question
     //document.getElementById('input1').innerText=o.opt1
     //document.getElementById('input2').innerText=o.opt2
     //document.getElementById('input3').innerText=o.opt3
     //document.getElementById('input4').innerText=o.opt4
     //document.getElementById('index').innerText=o.id+'. '
  //}
  
  //);
//}



        button();
        clock();
        function button() {
            var a = document.createDocumentFragment();

            for (let k = 1; k <= i; k++) {
                let btn = document.createElement("input");
                btn.innerHTML = k;
                btn.type = "submit";
                btn.name = "formBtn";
                btn.value = k;
                btn.id = `${k}`;
                btn.className = 'bttn'

                btn.onclick = function() {
                    v = parseInt(btn.value)
                   
                   
                    fetch(`http://127.0.0.1:8000/api/{{request.user}}/`, {
                        method: 'POST', 
                        headers: {
                            "X-CSRFToken": '{{csrf_token}}',
                            'Accept': 'application/json',
                          'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({'index':`${v}`}),
                      })
                      .then(r => r.json())
                      .then(r => {
                      let o=JSON.parse(r)
                      console.log(o.selectedOption)
                      
                       document.getElementById('ques').innerText=o.question
                       document.getElementById('input1').innerText=o.opt1
                       document.getElementById('input2').innerText=o.opt2
                       document.getElementById('input3').innerText=o.opt3
                       document.getElementById('input4').innerText=o.opt4
                       if(o.selectedOption!=='None'){
                           console.log('u')
                       document.getElementById(`${o.selectedOption}`).checked=true;
                       }
                       else{
                        console.log('ut')
                        document. querySelector('input[type=radio][name=aa]:checked').checked=false
                       }
        }).catch((error) => {
                        console.error('Error:', error);
                       
                      });
                    
                 document.getElementById('index').innerText=v+'. '
                   // if (v > 0) {
                       // document.getElementById(`${v}`).classList.add("color");
                   // }
                   colo();
                 
                   
                }
                a.appendChild(btn);


            }
            document.getElementById("buttons").appendChild(a);

        }

            function colo(){
        if(v>0){
  
         let x = document.getElementById(`${v}`)
         if(x.style.backgroundColor!='blue' ){
         x.style.backgroundColor='green'
         x.style.color='white'
     
         }

    }
    
  }



        document.addEventListener(mark(), 'click');
        document.addEventListener(next(), 'click');
        document.addEventListener(prev(), 'click');
        document.addEventListener(submit(), 'click');


        function submit(){
            fetch(`http://127.0.0.1:8000/credentials/exam/{{request.user}}/`, {
                method: 'POST', 
                headers: {
                    'Accept': 'application/json',
                  'Content-Type': 'application/json',
                },
                body: JSON.stringify({'msg':'True'}),
              })
              history.pushState({}, null, 'http://127.0.0.1:8000/credentials/');
              location.reload();
        }

        function next() {
            if (v === 0 || v>0) {

                v += 1;

                if (v > i) {
                    alert('No questions left, You can submit')
                    v = i;
                }
            }
           
                   colo();
                   fetch(`http://127.0.0.1:8000/api/{{request.user}}/`, {
                    method: 'POST', 
                    headers: {
                        "X-CSRFToken": '{{csrf_token}}',
                        'Accept': 'application/json',
                      'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({'index':`${v}`}),
                  })
                  .then(r => r.json())
                  .then(r => {
                    let o=JSON.parse(r)
                    console.log(o)
                    
                     document.getElementById('ques').innerText=o.question
                   
                     document.getElementById('input1').innerText=o.opt1
                     document.getElementById('input2').innerText=o.opt2
                     document.getElementById('input3').innerText=o.opt3
                     document.getElementById('input4').innerText=o.opt4
                     if(o.selectedOption!=='None'){
                        console.log('u')
                    document.getElementById(`${o.selectedOption}`).checked=true;
                    }
                    else{
                     console.log('ut')
                     document. querySelector('input[type=radio][name=aa]:checked').checked=false
                    }
                    }).catch((error) => {
                    console.error('Error:', error);
                   
                  });
                  document.getElementById('index').innerText=v+'. '
        }

        function prev() {
            if (v > 1 && v <= i) {
               
                v -= 1;

            }
            fetch(`http://127.0.0.1:8000/api/{{request.user}}/`, {
                method: 'POST', 
                headers: {
                    "X-CSRFToken": '{{csrf_token}}',
                    'Accept': 'application/json',
                  'Content-Type': 'application/json',
                },
                body: JSON.stringify({'index':`${v}`}),
              })
              .then(r => r.json())
              .then(r => {
                let o=JSON.parse(r)
                console.log(o)
                
                 document.getElementById('ques').innerText=o.question
                 document.getElementById('input1').innerText=o.opt1
                 document.getElementById('input2').innerText=o.opt2
                 document.getElementById('input3').innerText=o.opt3
                 document.getElementById('input4').innerText=o.opt4
                 if(o.selectedOption!=='None'){
                    console.log('u')
                document.getElementById(`${o.selectedOption}`).checked=true;
                }
                else{
                 console.log('ut')
                 document. querySelector('input[type=radio][name=aa]:checked').checked=false
                }
            }).catch((error) => {
                console.error('Error:', error);
               
              });
              document.getElementById('index').innerText=v+'. '
        }



        function mark() {
            if (v != 0) {
                let x=document.getElementById(`${v}`)
                x.style.backgroundColor='red';
                x.style.color='white'
            }
        }







        function clock() {
            let myTimer = setInterval(myClock, 1000);
            var c = 3600*{{dictt.exam_duration}};

            function myClock() {
                --c
                var seconds = c % 60;
                var secondsInMinutes = (c - seconds) / 60;
                var minutes = secondsInMinutes % 60;
                var hours = (secondsInMinutes - minutes) / 60;

                timer.innerHTML = (hours + ":" + minutes + ":" + seconds)
                if(seconds===55){
                    fetch(`http://127.0.0.1:8000/credentials/exam/{{request.user}}/`, {
                        method: 'POST', 
                        headers: {
                            'Accept': 'application/json',
                          'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({'msg':'True','type':'time','status':'online','user':'student'}),
                      })
                }

                if (c == 0) {
                    clearInterval(myTimer);
                    fetch(`http://127.0.0.1:8000/credentials/exam/{{request.user}}/`, {
                        method: 'POST', 
                        headers: {
                            'Accept': 'application/json',
                          'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({'msg':'True'}),
                      })
                      history.pushState({}, null, 'http://127.0.0.1:8000/credentials/');
                      location.reload();
                }
            }
        }
    </script>


    {% else %}
    <div class="container my-4">
        <div class="jumbotron">
            <h1 class="display-4">Remaining Time Is: <span id="time"></span></h1>
            <p class="lead">We are Here to show the time Remaining for your Exam So be ready and prepare.</p>
            <hr class="my-4">
            <h5  id="rtime"></h5>
            <p>Take preparation for your Exam and Best Of Luck for your Exam.</p>
            
          </div>
      </div>


      <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
      <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

      <script>
        let a;
        let date;
        let month;
        let rdate= {{dictt.exam_date}}
        let rmonth= {{dictt.exam_month}}
        let rtime={{dictt.exam_start_time}}
        let x = document.getElementById('time');
        let y = document.getElementById('rtime');
        y.innerText='Your Exam will start at'+' '+ rtime
        console.log(rdate, rmonth,rtime);
    
        a = new Date();
        date = a.getDate();
        month = a.getMonth()+1;
    
        console.log({{aa}});
    
        remain()
        function remain() {
            let newdate = rdate - date;
            let newmonth = rmonth - month;
            if (month===rmonth) 
            {
                let total = newdate + 'days';
                x.innerHTML = total;
            }
            else{
                let total =  newdate + ' ' + 'days' + ' ' + newmonth + ' ' + 'months';
                x.innerHTML = total;
            }
                
        }
    </script>

{% endif %}














</body>


</html>